---
---
<script src="https://cdn.jsdelivr.net/npm/pako@2.1.0/dist/pako.min.js"></script>
<script>
  document.addEventListener("DOMContentLoaded", () => {
    const params = new URLSearchParams(window.location.search);
    const dataParam = params.get("data");
    if (!dataParam) {
      window.location.href = "/";
      return;
    }
    try {
      // Convert base64url to base64
      const base64 = dataParam.replace(/-/g, "+").replace(/_/g, "/");
      // Decode base64 to binary string
      const binaryString = atob(base64);
      // Convert binary string to Uint8Array
      const len = binaryString.length;
      const bytes = new Uint8Array(len);
      for (let i = 0; i < len; i++) {
        bytes[i] = binaryString.charCodeAt(i);
      }
      // Decompress
      const decompressed = pako.inflate(bytes, { to: "string" });
      // Parse JSON
      const appData = JSON.parse(decompressed);
      // Restore to localStorage
      if (appData.weightUnit) localStorage.setItem("weightUnit", appData.weightUnit);
      if (Array.isArray(appData.weightEntries)) localStorage.setItem("weightEntries", JSON.stringify(appData.weightEntries));
      // Redirect to home
      window.location.href = "/";
    } catch (e) {
      alert("Failed to import data. The link may be invalid or corrupted.");
      window.location.href = "/";
    }
  });
</script>