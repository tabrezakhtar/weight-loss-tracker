---
// WeightList component - displays all weight entries from localStorage
---

<div class="w-full bg-white rounded-xl shadow p-6 mt-6 flex flex-col gap-4 flex-1 min-h-0">
  <h2 class="text-xl font-semibold text-slate-700 flex items-center gap-2">ðŸ“œ Weight History</h2>
  <p class="text-sm text-slate-500">Edit your weight entries directly and save changes</p>
  <div id="no-entries-message" class="text-slate-400 py-4 text-center">No weight entries found. Add your first entry above.</div>
  <ul id="weight-entries-list" class="flex flex-col gap-3 overflow-y-auto pr-1 flex-1"></ul>
</div>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const entriesList = document.getElementById("weight-entries-list");
    const noEntriesMessage = document.getElementById("no-entries-message");
    if (!entriesList || !noEntriesMessage) return;

    const createEntryElement = (entry) => {
      const listItem = document.createElement("li");
      listItem.dataset.id = entry.id;
      listItem.className = "flex flex-col sm:flex-row items-center gap-2 bg-stone-50 rounded-lg p-3 shadow border border-slate-200";

      // Weight input
      const weightDiv = document.createElement("div");
      weightDiv.className = "flex flex-col w-full sm:w-1/3";
      const weightLabel = document.createElement("label");
      weightLabel.className = "text-xs text-slate-500 mb-1";
      weightLabel.textContent = "Weight";
      const weightInput = document.createElement("input");
      weightInput.type = "number";
      weightInput.step = "0.1";
      weightInput.min = "0";
      weightInput.value = entry.weight;
      weightInput.className = "input input-bordered w-full px-2 py-1 rounded border border-slate-300 focus:outline-none focus:ring-2 focus:ring-blue-400 bg-white";
      weightDiv.appendChild(weightLabel);
      weightDiv.appendChild(weightInput);

      // Date input
      const dateDiv = document.createElement("div");
      dateDiv.className = "flex flex-col w-full sm:w-1/3";
      const dateLabel = document.createElement("label");
      dateLabel.className = "text-xs text-slate-500 mb-1";
      dateLabel.textContent = "Date";
      const dateInput = document.createElement("input");
      dateInput.type = "date";
      dateInput.value = entry.date;
      dateInput.className = "input input-bordered w-full px-2 py-1 rounded border border-slate-300 focus:outline-none focus:ring-2 focus:ring-blue-400 bg-white";
      dateDiv.appendChild(dateLabel);
      dateDiv.appendChild(dateInput);

      // Actions
      const actionsDiv = document.createElement("div");
      actionsDiv.className = "flex flex-col gap-2 w-full sm:w-1/3 justify-end items-center mt-2 sm:mt-0";
      const saveBtn = document.createElement("button");
      saveBtn.type = "button";
      saveBtn.className = "flex items-center gap-1 bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded-lg font-semibold transition-all duration-150 w-24 justify-center";
      saveBtn.title = "Save changes";
      saveBtn.innerHTML = "<span class='hidden sm:inline'>Save</span>";
      const deleteBtn = document.createElement("button");
      deleteBtn.type = "button";
      deleteBtn.className = "flex items-center gap-1 bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded-lg font-semibold transition-all duration-150 w-24 justify-center";
      deleteBtn.title = "Delete entry";
      deleteBtn.innerHTML = "<span class='hidden sm:inline'>Delete</span>";

      saveBtn.addEventListener("click", () => {
        const newWeight = weightInput.value;
        const newDate = dateInput.value;
        if (!newWeight || !newDate) return;
        if (newWeight !== entry.weight || newDate !== entry.date) {
          updateEntry(entry.id, { weight: newWeight, date: newDate });
        }
      });
      deleteBtn.addEventListener("click", () => {
        if (confirm("Are you sure you want to delete this entry?")) {
          deleteEntry(entry.id);
        }
      });
      weightInput.addEventListener("change", () => {
        if (weightInput.value) updateEntry(entry.id, { weight: weightInput.value });
      });
      dateInput.addEventListener("change", () => {
        if (dateInput.value) updateEntry(entry.id, { date: dateInput.value });
      });
      actionsDiv.appendChild(saveBtn);
      actionsDiv.appendChild(deleteBtn);

      listItem.appendChild(weightDiv);
      listItem.appendChild(dateDiv);
      listItem.appendChild(actionsDiv);
      return listItem;
    };

    const renderEntries = () => {
      entriesList.innerHTML = "";
      const entries = JSON.parse(localStorage.getItem("weightEntries") || "[]");
      entries.sort((a, b) => new Date(b.date) - new Date(a.date));
      if (entries.length === 0) {
        noEntriesMessage.style.display = "block";
        entriesList.style.display = "none";
      } else {
        noEntriesMessage.style.display = "none";
        entriesList.style.display = "flex";
        entries.forEach(entry => entriesList.appendChild(createEntryElement(entry)));
      }
    };

    const updateEntry = (id, updates) => {
      const entries = JSON.parse(localStorage.getItem("weightEntries") || "[]");
      const updatedEntries = entries.map(entry => entry.id === id ? { ...entry, ...updates, timestamp: new Date().toISOString() } : entry);
      localStorage.setItem("weightEntries", JSON.stringify(updatedEntries));
      renderEntries();
    };

    const deleteEntry = (id) => {
      const entries = JSON.parse(localStorage.getItem("weightEntries") || "[]");
      const updatedEntries = entries.filter(entry => entry.id !== id);
      localStorage.setItem("weightEntries", JSON.stringify(updatedEntries));
      renderEntries();
      window.dispatchEvent(new CustomEvent("weightEntryDeleted"));
    };

    window.addEventListener("weightEntrySaved", () => renderEntries());
    renderEntries();
  });
</script>