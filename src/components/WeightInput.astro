---

---
<style>
  @keyframes bounce {
    0%, 20%, 50%, 80%, 100% {
      transform: translateY(0);
    }
    40% {
      transform: translateY(-8px);
    }
    60% {
      transform: translateY(-4px);
    }
  }
</style>

<div class="w-full bg-white rounded-xl border-2 border-slate-200 p-3 sm:p-4 md:p-6 flex flex-col gap-2 sm:gap-4">
  <h2 class="text-base sm:text-lg md:text-xl font-semibold text-slate-700 flex items-center gap-2">üç≠ Add Weight Entry</h2>
  <form id="weight-form" class="w-full flex flex-col gap-2 sm:gap-4">
    <div class="flex flex-col sm:flex-row gap-2 sm:gap-4 w-full items-end">
      <div class="flex flex-col w-full sm:w-1/2">
        <label for="weight" id="weight-label" class="text-sm sm:text-base text-slate-600 font-medium mb-1">Weight (kg)</label>
        <input 
          type="number" 
          id="weight" 
          name="weight" 
          step="0.1" 
          min="0" 
          required
          class="input input-bordered w-full px-2 sm:px-3 py-1 sm:py-2 rounded-md border border-slate-300 focus:outline-none focus:ring-2 focus:ring-blue-400 bg-white text-sm sm:text-base"
        />
      </div>
      <div class="flex flex-col w-full sm:w-1/2">
        <label for="weight-date" class="text-sm sm:text-base text-slate-600 font-medium mb-1">Date</label>
        <input 
          type="date" 
          id="weight-date" 
          name="date" 
          value={new Date().toISOString().split("T")[0]} 
          required
          class="input input-bordered w-full px-2 sm:px-3 py-1 sm:py-2 rounded-md border border-slate-300 focus:outline-none focus:ring-2 focus:ring-blue-400 bg-white text-sm sm:text-base"
        />
      </div>
      <button type="submit" id="add-button" class="flex items-center justify-center gap-1 sm:gap-2 bg-blue-600 hover:bg-blue-700 text-white font-semibold px-3 sm:px-4 py-1 sm:py-2 rounded-lg shadow transition-all duration-150 text-sm sm:text-base">
        <span>Add</span>
      </button>
    </div>
    <div id="submission-message" role="status" class="text-xs sm:text-sm text-red-500"></div>
  </form>
</div>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const form = document.getElementById("weight-form");
    const messageElement = document.getElementById("submission-message");
    const weightLabel = document.getElementById("weight-label");
    const addButton = document.getElementById("add-button");
    
    if (!form || !messageElement || !weightLabel || !addButton) {
      console.error("Required DOM elements not found");
      return;
    }
    
    setTimeout(() => {
      addButton.style.animation = "bounce 0.6s ease-in-out 3";
      setTimeout(() => {
        addButton.style.animation = "";
      }, 2000);
    }, 1000);
    
    const updateUnitLabel = () => {
      const currentUnit = localStorage.getItem("weightUnit") || "kg";
      weightLabel.textContent = `Weight (${currentUnit})`;
    };
    
    updateUnitLabel();
    
    window.addEventListener("weightUnitChanged", () => {
      updateUnitLabel();
    });
    
    const generateId = () => {
      return Date.now().toString(36) + Math.random().toString(36).substr(2);
    };
    
    const saveWeightEntry = (entry) => {
      const existingEntries = JSON.parse(localStorage.getItem("weightEntries") || "[]");
      
      const currentUnit = localStorage.getItem("weightUnit") || "kg";
      const newEntry = {
        id: generateId(),
        weight: entry.weight,
        date: entry.date,
        unit: currentUnit,
        timestamp: new Date().toISOString()
      };
      
      existingEntries.push(newEntry);
      localStorage.setItem("weightEntries", JSON.stringify(existingEntries));
      
      return newEntry;
    };
    
    form.addEventListener("submit", (e) => {
      e.preventDefault();
      
      const weightInput = document.getElementById("weight");
      const dateInput = document.getElementById("weight-date");
      
      if (!weightInput || !dateInput) {
        console.error("Form input elements not found");
        return;
      }
      
      const weight = weightInput.value;
      const date = dateInput.value;
      
      if (!weight || !date) {
        messageElement.textContent = "Please fill in all required fields";
        messageElement.style.color = "red";
        return;
      }
      
      const savedEntry = saveWeightEntry({ weight, date });
      
      confetti({
        particleCount: 150,
        spread: 80,
        origin: { y: 0.6 }
      });

      form.reset();
      
      dateInput.value = new Date().toISOString().split("T")[0];
      
      const weightEvent = new CustomEvent("weightEntrySaved", {
        detail: savedEntry,
        bubbles: true,
        cancelable: true
      });
      console.log("Dispatching weightEntrySaved event", savedEntry);
      window.dispatchEvent(weightEvent);
    });
  });
</script>