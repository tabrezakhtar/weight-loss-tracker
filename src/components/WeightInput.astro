---

---

<div class="card medium-padding">
  <h5 class="primary-text">Add Weight Entry</h5>
  
  <form id="weight-form" class="medium-margin">
    <div class="row wrap middle-align">
      <div class="field label border s12 m6 l5 fill-space">
        <input 
          type="number" 
          id="weight" 
          name="weight" 
          step="0.1" 
          min="0" 
          required
        />
        <label for="weight">Weight</label>
      </div>

      <div class="field label border s12 m6 l5 fill-space small-margin-top medium-margin-left">
        <input 
          type="date" 
          id="weight-date" 
          name="date" 
          value={new Date().toISOString().split("T")[0]} 
          required
        />
        <label for="weight-date">Date</label>
      </div>
      
      <div class="s12 row middle-align right-align small-margin-top">
        <button type="submit" class="primary round">
          <i>add</i>
          <span>Add Entry</span>
        </button>
      </div>
    </div>
  </form>
  
  <div id="submission-message" role="status" class="tertiary-text"></div>
</div>

<script>
  // Wait for the DOM to be fully loaded
  document.addEventListener("DOMContentLoaded", () => {
    const form = document.getElementById("weight-form");
    const messageElement = document.getElementById("submission-message");
    
    if (!form || !messageElement) {
      console.error("Required DOM elements not found");
      return;
    }
    
    // Function to generate a unique ID
    const generateId = () => {
      return Date.now().toString(36) + Math.random().toString(36).substr(2);
    };
    
    // Function to save weight entry to localStorage
    const saveWeightEntry = (entry) => {
      // Get existing entries from localStorage or initialize empty array
      const existingEntries = JSON.parse(localStorage.getItem("weightEntries") || "[]");
      
      // Add new entry with unique ID
      const newEntry = {
        id: generateId(),
        weight: entry.weight,
        date: entry.date,
        timestamp: new Date().toISOString()
      };
      
      // Add to array and save back to localStorage
      existingEntries.push(newEntry);
      localStorage.setItem("weightEntries", JSON.stringify(existingEntries));
      
      return newEntry;
    };
    
    // Handle form submission
    form.addEventListener("submit", (e) => {
      e.preventDefault();
      
      // Get form data
      const weightInput = document.getElementById("weight");
      const dateInput = document.getElementById("weight-date");
      
      if (!weightInput || !dateInput) {
        console.error("Form input elements not found");
        return;
      }
      
      const weight = weightInput.value;
      const date = dateInput.value;
      
      if (!weight || !date) {
        messageElement.textContent = "Please fill in all required fields";
        messageElement.style.color = "red";
        return;
      }
      
      // Save the entry
      const savedEntry = saveWeightEntry({ weight, date });
      
      // Show success message
      // messageElement.textContent = `Weight entry saved successfully (ID: ${savedEntry.id})`;
      // messageElement.style.color = "green";
      
      // Reset form
      form.reset();
      
      // Set the date field back to today
      dateInput.value = new Date().toISOString().split("T")[0];
      
      // Dispatch custom event for other components (like WeightList) to listen for
      const weightEvent = new CustomEvent("weightEntrySaved", {
        detail: savedEntry,
        bubbles: true,
        cancelable: true
      });
      console.log("Dispatching weightEntrySaved event", savedEntry);
      window.dispatchEvent(weightEvent);
    });
  });
</script>

<!-- BeerCSS handles all the styling so we don't need custom CSS -->