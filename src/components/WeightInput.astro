---

---

<div class="w-full bg-white rounded-xl border-2 border-slate-200 p-3 sm:p-4 md:p-6 flex flex-col gap-2 sm:gap-4">
  <h2 class="text-base sm:text-lg md:text-xl font-semibold text-slate-700 flex items-center gap-2">üç≠ Add Weight Entry</h2>
  <form id="weight-form" class="w-full flex flex-col gap-2 sm:gap-4">
    <div class="flex flex-col sm:flex-row gap-2 sm:gap-4 w-full items-end">
      <div class="flex flex-col w-full sm:w-1/2">
        <label for="weight" id="weight-label" class="text-sm sm:text-base text-slate-600 font-medium mb-1">Weight (kg)</label>
        <input 
          type="number" 
          id="weight" 
          name="weight" 
          step="0.1" 
          min="0" 
          required
          class="input input-bordered w-full px-2 sm:px-3 py-1 sm:py-2 rounded-md border border-slate-300 focus:outline-none focus:ring-2 focus:ring-blue-400 bg-white text-sm sm:text-base"
        />
      </div>
      <div class="flex flex-col w-full sm:w-1/2">
        <label for="weight-date" class="text-sm sm:text-base text-slate-600 font-medium mb-1">Date</label>
        <input 
          type="date" 
          id="weight-date" 
          name="date" 
          value={new Date().toISOString().split("T")[0]} 
          required
          class="input input-bordered w-full px-2 sm:px-3 py-1 sm:py-2 rounded-md border border-slate-300 focus:outline-none focus:ring-2 focus:ring-blue-400 bg-white text-sm sm:text-base"
        />
      </div>
      <button type="submit" class="flex items-center justify-center gap-1 sm:gap-2 bg-blue-600 hover:bg-blue-700 text-white font-semibold px-3 sm:px-4 py-1 sm:py-2 rounded-lg shadow transition-all duration-150 text-sm sm:text-base">
        <span>Add</span>
      </button>
    </div>
    <div id="submission-message" role="status" class="text-xs sm:text-sm text-red-500"></div>
  </form>
</div>

<script>
  // Wait for the DOM to be fully loaded
  document.addEventListener("DOMContentLoaded", () => {
    const form = document.getElementById("weight-form");
    const messageElement = document.getElementById("submission-message");
    const weightLabel = document.getElementById("weight-label");
    
    if (!form || !messageElement || !weightLabel) {
      console.error("Required DOM elements not found");
      return;
    }
    
    // Update the weight label with the current unit
    const updateUnitLabel = () => {
      const currentUnit = localStorage.getItem("weightUnit") || "kg";
      weightLabel.textContent = `Weight (${currentUnit})`;
    };
    
    // Initial label update
    updateUnitLabel();
    
    // Listen for unit changes
    window.addEventListener("weightUnitChanged", () => {
      updateUnitLabel();
    });
    
    // Function to generate a unique ID
    const generateId = () => {
      return Date.now().toString(36) + Math.random().toString(36).substr(2);
    };
    
    // Function to save weight entry to localStorage
    const saveWeightEntry = (entry) => {
      // Get existing entries from localStorage or initialize empty array
      const existingEntries = JSON.parse(localStorage.getItem("weightEntries") || "[]");
      
      // Add new entry with unique ID and current unit
      const currentUnit = localStorage.getItem("weightUnit") || "kg";
      const newEntry = {
        id: generateId(),
        weight: entry.weight,
        date: entry.date,
        unit: currentUnit,
        timestamp: new Date().toISOString()
      };
      
      // Add to array and save back to localStorage
      existingEntries.push(newEntry);
      localStorage.setItem("weightEntries", JSON.stringify(existingEntries));
      
      return newEntry;
    };
    
    // Handle form submission
    form.addEventListener("submit", (e) => {
      e.preventDefault();
      
      // Get form data
      const weightInput = document.getElementById("weight");
      const dateInput = document.getElementById("weight-date");
      
      if (!weightInput || !dateInput) {
        console.error("Form input elements not found");
        return;
      }
      
      const weight = weightInput.value;
      const date = dateInput.value;
      
      if (!weight || !date) {
        messageElement.textContent = "Please fill in all required fields";
        messageElement.style.color = "red";
        return;
      }
      
      // Save the entry
      const savedEntry = saveWeightEntry({ weight, date });
      
      // Show success message
      // messageElement.textContent = `Weight entry saved successfully (ID: ${savedEntry.id})`;
      // messageElement.style.color = "green";
      
      // Reset form
      form.reset();
      
      // Set the date field back to today
      dateInput.value = new Date().toISOString().split("T")[0];
      
      // Dispatch custom event for other components (like WeightList) to listen for
      const weightEvent = new CustomEvent("weightEntrySaved", {
        detail: savedEntry,
        bubbles: true,
        cancelable: true
      });
      console.log("Dispatching weightEntrySaved event", savedEntry);
      window.dispatchEvent(weightEvent);
    });
  });
</script>